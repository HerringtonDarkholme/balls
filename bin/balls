#!/bin/bash
BALLS_LIB=$(dirname $0)/../lib
BALLS_LIB=$(readlink -f "$BALLS_LIB")
mode=$1; shift
while getopts 'e:C:' opt; do
  case $opt in
    C) BALLS_CONF=$OPTARG ;;
    e) BALLS_ENV=$OPTARG ;;
    *) echo "Usage: $0 <mode> [options]"; exit 1 ;;
  esac
done
[[ -z "$BALLS_ENV" ]] && BALLS_ENV=development
[[ -z "$BALLS_CONF" ]] && BALLS_CONF=./config/config.sh
. "$BALLS_CONF"
[ -f ./config/environments/$BALLS_ENV.sh ] && . ./config/environments/$BALLS_ENV.sh
. $BALLS_LIB/balls.sh
case $mode in
  server|s) balls::server ;;
  migrate) model::migrate ;;
  *) echo "unknown" ;;
esac
